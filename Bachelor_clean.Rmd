---
title: "Bachelor_clean"
author: "Julie Svinth Nielsen"
date: "24/11/2021"
output: html_document
---



```{r}


library(tidyverse)
library(readr)
library(dplyr)
library(lme4)
library(tidyr)
library(ggpubr)
library(rstatix)
library(coin)
library(cowplot) 
library(lme4) 
library(sjPlot) 
library(sjmisc) 
library(effects)
library(sjstats) 
library(ggthemes)
```

```{r}
df_big_final <- read_csv("df_big_final.csv")


df_w_3$oms_con <- "j"
df_w_3[c(21, 23, 2, 12, 14 ), 15] <- c("7")
df_w_3[c(17, 22), 15] <- c("5")
df_w_3[c(4, 3, 6, 15, 7), 15] <- c("3")
df_w_3[c(8, 10, 11, 9, 19, 1, 13, 16, 5, 18, 20), 15] <- c("2")




```



```{r}


###### Bar plot

df_bar_overall <- df_big_final %>%
  ggplot(aes(week, oms, fill = intervention))+geom_bar( stat = "summary", position = "dodge")+ 
  xlab("Intervention week")+ ylab("Mean of sold products")

df_bar_overall
```


####### Help from Tyl√©n 
```{r}

# Create data frames for each week
df_week_1 <- filter(df_big_final, week != 2 & week !=3)

df_week_2 <- filter(df_big_final, week != 1 & week !=3)

df_week_3 <- filter(df_big_final, week != 1 & week !=2)


```

Model making
```{r}

# Load in data
df_w_1 <- read_csv("df_w_1.csv")
df_w_2 <- read_csv("df_w_2.csv")
df_w_3 <- read_csv("df_w_3.csv")



# Statistical summaries of difference
summary(df_w_1$diff)
summary(df_w_2$diff)
summary(df_w_3$diff)



library(ggpubr)
ggboxplot(df_w_1$diff, 
          ylab = "difference", xlab = FALSE,
          ggtheme = theme_minimal())


ggboxplot(df_w_2$diff, 
          ylab = "difference", xlab = FALSE,
          ggtheme = theme_minimal())


ggboxplot(df_w_3$diff, 
          ylab = "difference", xlab = FALSE,
          ggtheme = theme_minimal())


```


```{r}



# Hypothesis 1
df_w_1$diff_perc <- (df_w_1$oms.x - df_w_1$oms.y)/df_w_1$oms.y*100

df_w_1$diff_perc <- round(df_w_1$diff_perc, digits = 1)


mean(df_w_1$diff_perc, na.rm = TRUE)
sd(df_w_1$diff_perc, na.rm = TRUE)



# Visualizing
bxp_w_1 <- ggboxplot(
  df_w_1$diff_perc, width = 0.5, add = c("mean", "jitter"), 
  ylab = "Difference (%)", xlab = "Labeling"
  )+
  ggtitle("Boxplot of Label Intervention")+
  theme_solarized()

bxp_w_1

df_w_1 %>% 
  get_summary_stats(diff_perc, type = "median_iqr")

df_w_1 %>% 
  get_summary_stats(diff, type = "median_iqr")


# Normality
ggqqplot(df_w_1, x = "diff_perc") # Not normal

gghistogram(df_w_1, x = "diff_perc", y = "..density..", 
            fill = "steelblue",bins = 10, add_density = TRUE)


# Using one-tailed one-sample  Wilcoxon test 
wilcox.test(df_w_1$diff_perc, mu = 0, alternative = "greater")




# Effect size 
df_w_1 %>%  wilcox_effsize(diff_perc ~ 1, mu = 0, alternative = "greater") # small effect size





```


```{r}
# Hypothesis 2

#df_w_2$diff_perc <- (df_w_2$oms.x - df_w_2$oms.y)/df_w_2$oms.y*100

#df_w_2$diff_perc <- round(df_w_2$diff_perc, digits = 1)





# Visualizing
bxp_w_2 <- ggboxplot(
  df_w_2$diff_perc, width = 0.5, add = c("mean", "jitter"), 
  ylab = "Difference (%)", xlab = "Nudging"
  )+
  ggtitle("Boxplot of Nudging Intervention")+
  theme_solarized()

bxp_w_2

df_w_2 %>% 
  get_summary_stats(diff_perc, type = "median_iqr")

df_w_2 %>% 
  get_summary_stats(diff, type = "median_iqr")


# Normality
ggqqplot(df_w_2, x = "diff_perc")
df_w_2 %>% shapiro_test(diff_perc) # Assuming no normal distribution


gghistogram(df_w_2, x = "diff_perc", y = "..density..", 
            fill = "steelblue",bins = 4, add_density = TRUE)


# Using one-tailed one-sample  Wilcoxon test 
wilcox.test(df_w_2$diff_perc, mu = 0, alternative = "greater")




# Effect size 
df_w_2 %>%  wilcox_effsize(diff_perc ~ 1, mu = 0, alternative = "greater") # small effect size





bxp_w_2 

```

```{r}
# Hypothesis 3




# Data including the convenience bags numbers

df_w_3$oms_con <- as.numeric(df_w_3$oms_con)
df_w_3$oms_con <- df_w_3$oms_con + df_w_3$oms.x


df_w_3$diff_con <- df_w_3$oms_con - df_w_3$oms.y

df_w_3$diff_con_perc <- (df_w_3$oms_con - df_w_3$oms.y)/df_w_3$oms.y*100

df_w_3$diff_con_perc <- round(df_w_3$diff_con_perc, digits = 1)

# Data without the convenience bags

df_w_3$diff_perc <- (df_w_3$oms.x - df_w_3$oms.y)/df_w_3$oms.y*100

df_w_3$diff_perc <- round(df_w_3$diff_perc, digits = 1)


df_con <- df_w_3[,c(1, 4, 8, 17)]
df_con$intervention <- "convenience_bags"

df_con <- df_con %>% 
  rename(
    diff_perc = diff_con_perc)


df_try <- bind_rows(list(df_w_3, df_con), .id = "X1")



df_try$intervention <- "inspiration"

df_try$int_type <- "Inspiration"
df_try[c(24:46), 18] <- c("Convenience_bag")





# Visualizing
bxp_w_3 <- ggboxplot(
  df_w_3$diff_perc, width = 0.5, add = c("mean", "jitter"), 
  ylab = "Difference (%)", xlab = "Inspiration"
  )+
  ggtitle("Boxplot of Inspiration Intervention")+
  theme_solarized()




bxp_w_3




df_w_3 %>% 
  get_summary_stats(diff_perc, type = "median_iqr")
df_w_3 %>% 
  get_summary_stats(diff, type = "median_iqr")

# Normality
ggqqplot(df_w_3, x = "diff_perc")

df_w_3 %>% shapiro_test(diff_perc) # Assuming no normal distribution


gghistogram(df_w_3, x = "diff_perc", y = "..density..", 
            fill = "steelblue",bins = 10, add_density = TRUE)


# Using one-tailed one-sample  Wilcoxon test 
wilcox.test(df_w_3$diff_perc, mu = 0, alternative = "greater")




# Effect size 
df_w_3 %>%  wilcox_effsize(diff_perc ~ 1, mu = 0, alternative = "greater") # small effect size



bxp_w_3
```
```{r}
# Boxplot collection for H1, H2, H3 and H4

library(patchwork)

(bxp_w_1 /bxp_w_2 ) | (bxp_w_3/bxp_lab_nug)


```


Visualization
```{r}

df_try <- bind_rows(list(df_w_3, df_con), .id = "X1")

df_overall$int_type <- NA

df_overall$X1 <- as.character(df_overall$X1)

df_overall <- bind_rows(df_overall, df_try, .id = "X1")

df_overall <- rbind(df_w_1, df_w_2, df_w_3)

df_overall$intervention <- as.factor(df_overall$intervention)
df_overall$int_type <- as.factor(df_overall$int_type)


df_overall %>%
  group_by(intervention, int_type) %>%
  summarise(mean_difference_score = mean(diff_perc, na.rm = T), se = sd(diff_perc, na.rm = T)/(sqrt(length(diff_perc)))) %>% 
  ggplot(aes(x = intervention, y = mean_difference_score, fill = int_type)) +
  geom_bar() +
  geom_errorbar(aes(ymin=mean_difference_score-se, ymax=mean_difference_score+se), width=.2,
                position=position_dodge(.9))



write.csv(x=df_overall, file="df_overall.csv")

```

Hypothesis 4
```{r}

df_lab_nug <- read_csv("df_lab_nug.csv")

df_lab_nug$intervention <- as.factor(df_lab_nug$intervention)


df_lab_nug %>%
  group_by(intervention) %>%
  get_summary_stats(diff_perc, type = "median_iqr")


# Visualizing data
bxp_lab_nug <- ggboxplot(
  df_lab_nug, x = "intervention", y = "diff_perc", fill = "intervention",
  ylab = "Mean difference score (%)", xlab = "Intervention", add = "jitter"
  )+
  ggtitle(" B) Comparing Nudging and Labeling")+
  theme_solarized()+
  scale_fill_brewer(palette="Blues")


bxp_lab_nug


# Normality
ggqqplot(df_lab_nug, x = "diff_perc", facet.by = "intervention") # Not normal distributed


# Wilcoxon Rank Sum Test
df_lab_nug$intervention <- relevel(df_lab_nug$intervention, ref = "nudge")


wilcox_test(diff_perc ~ intervention, alternative = "greater", data = df_lab_nug, paired = F) 



 # Effect size
wilcox_effsize(diff_perc ~ intervention, alternative = "greater", data = df_lab_nug)

 
# The median weight in female group was 62.9 (IQR = 2.33), whereas the median in male group was 86.3 (IQR = 4.59). The Wilcoxon test showed that the difference was significant (p < 0.0001, effect size r = 0.86).

```


```{r}
# Does inspiration have a greater effect than the two other interventions

# Relevel intervention - inspiration as baseline
df_overall$intervention <- relevel(df_overall$intervention, ref = "inspiration")
df_overall$vare_grp <- as.factor(df_overall$vare_grp)

m1 <- lm(diff_perc ~ intervention, data = df_overall)

summary(m1)

plot(m1)



# Normality
hist(df_overall$diff_perc)



plot(diff_perc ~ intervention, data = df_overall)


par(mfrow=c(2,2))


plot(m1)




sjPlot::plot_model(m1, 
                   axis.labels=c("Nudging", "Labeling", "Intercept(Inspiration)"),
                   show.values=T, show.p=T, show.intercept = T,
                   title="Effect of Intervention on Climate-friendly Products - Measured as Difference score (in %)")


sjPlot::tab_model(m1, 
                  show.re.var= TRUE, 
                  pred.labels =c("(Intercept)", "Labeling", "Nudging"),
                  dv.labels= "Effect of Intervention on Climate-friendly Products - Measured as Difference score (in %)")
```


# T-test
```{r}
# Hypothesis 1


wilcox.test(df_w_1$diff_perc, mu = 0, alternative = "greater")

# Hypothesis 2
wilcox.test(df_w_2$diff_perc, mu = 0, alternative = "greater")

# Hypothesis 3
wilcox.test(df_w_3$diff_perc, mu = 0, alternative = "greater")


```


```{r}
df_overall$diff_perc <- (df_overall$oms.x - df_overall$oms.y)/df_overall$oms.y*100

df_overall$diff_perc <- round(df_overall$diff_perc, digits = 1)

install.packages('ggthemes', dependencies = TRUE)
library(ggthemes)


df_plot <- df_overall %>%
  group_by(intervention) %>%
  summarise(mean_difference_score = mean(diff_perc, na.rm = T), se = sd(diff_perc, na.rm = T)/(sqrt(length(diff_perc)))) %>% 
  ggplot(aes(intervention, mean_difference_score, fill = intervention)) +
  geom_bar(stat = "summary") +
  geom_errorbar(aes(ymin=mean_difference_score-se, ymax=mean_difference_score+se), width=.2,
                position=position_dodge(.9))+
  theme_solarized()+
  scale_fill_brewer(palette="Blues")+
  labs(x = "Intervention", y = "Mean difference score (%)")+
  ggtitle("A) Intervention Effect on Purchase of Climate-friendly Products")


df_plot + bxp_lab_nug
```



