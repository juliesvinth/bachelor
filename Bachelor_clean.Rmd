---
title: "Bachelor_clean"
author: "Julie Svinth Nielsen"
date: "24/11/2021"
output: html_document
---



```{r}


library(tidyverse)
library(readr)
library(dplyr)
library(lme4)
library(tidyr)
library(ggpubr)
library(rstatix)
```

```{r}
df_big_final <- read_csv("df_big_final.csv")



```



```{r}


###### Bar plot

df_bar_overall <- df_big_final %>%
  ggplot(aes(week, oms, fill = intervention))+geom_bar( stat = "summary", position = "dodge")+ 
  xlab("Intervention week")+ ylab("Mean of sold products")

df_bar_overall
```


####### Help from Tyl√©n 
```{r}

# Create data frames for each week
df_week_1 <- filter(df_big_final, week != 2 & week !=3)

df_week_2 <- filter(df_big_final, week != 1 & week !=3)

df_week_3 <- filter(df_big_final, week != 1 & week !=2)


```

Model making
```{r}

# Load in data
df_w_1 <- read_csv("df_w_1.csv")
df_w_2 <- read_csv("df_w_2.csv")
df_w_3 <- read_csv("df_w_3.csv")



# Statistical summaries of difference
summary(df_w_1$diff)
summary(df_w_2$diff)
summary(df_w_3$diff)



library(ggpubr)
ggboxplot(df_w_1$diff, 
          ylab = "difference", xlab = FALSE,
          ggtheme = theme_minimal())


ggboxplot(df_w_2$diff, 
          ylab = "difference", xlab = FALSE,
          ggtheme = theme_minimal())


ggboxplot(df_w_3$diff, 
          ylab = "difference", xlab = FALSE,
          ggtheme = theme_minimal())


```


```{r}



# Hypothesis 1
df_w_1$diff_perc <- (df_w_1$oms.x - df_w_1$oms.y)/df_w_1$oms.y*100

df_w_1$diff_perc <- round(df_w_1$diff_perc, digits = 1)


mean(df_w_1$diff_perc, na.rm = TRUE)
sd(df_w_1$diff_perc, na.rm = TRUE)



# Visualizing
bxp_w_1 <- ggboxplot(
  df_w_1$diff_perc, width = 0.5, add = c("mean", "jitter"), 
  ylab = "Difference (%)", xlab = FALSE
  )+
  ggtitle("Boxplot of Label Intervention")+
  theme_solarized()

bxp_w_1



# Normality
ggqqplot(df_w_1, x = "diff_perc")

stat.test <- t.test(df_w_1$diff_perc, mu = 0, alternative = "greater")
stat.test_1


# Effect size
df_w_1 %>% cohens_d(diff_perc ~ 1, mu = 0) # small effect size

# Density plot
ggdensity(df_w_1, x = "diff_perc", rug = TRUE, fill = "lightgray") +
  scale_x_continuous(limits = c(-75, 75)) +
  stat_central_tendency(type = "mean", color = "red", linetype = "dashed") +
  geom_vline(xintercept = 0, color = "blue", linetype = "dashed") 




```


```{r}
# Hypothesis 2

df_w_2$diff_perc <- (df_w_2$oms.x - df_w_2$oms.y)/df_w_2$oms.y*100

df_w_2$diff_perc <- round(df_w_2$diff_perc, digits = 1)


mean(df_w_2$diff_perc)
sd(df_w_2$diff_perc)



# Visualizing
bxp_w_2 <- ggboxplot(
  df_w_2$diff_perc, width = 0.5, add = c("mean", "jitter"), 
  ylab = "Difference (%)", xlab = FALSE
  )+
  ggtitle("Boxplot of Nudging Intervention")+
  theme_solarized()

bxp_w_2



# Normality
ggqqplot(df_w_2, x = "diff_perc")

stat.test <- t.test(df_w_2$diff_perc, mu = 0, alternative = "greater")



# Effect size
df_w_2 %>% cohens_d(diff_perc ~ 1, mu = 0) # small effect size

# Density plot
ggdensity(df_w_2, x = "diff_perc", rug = TRUE, fill = "lightgray") +
  scale_x_continuous(limits = c(-60, 145)) +
  stat_central_tendency(type = "mean", color = "red", linetype = "dashed") +
  geom_vline(xintercept = 0, color = "blue", linetype = "dashed") 



bxp_w_2 

```

```{r}
# Hypothesis 3
df_w_3$diff_perc <- (df_w_3$oms.x - df_w_3$oms.y)/df_w_3$oms.y*100

df_w_3$diff_perc <- round(df_w_3$diff_perc, digits = 1)



mean(df_w_3$diff_perc)
sd(df_w_3$diff_perc)



# Visualizing
bxp_w_3 <- ggboxplot(
  df_w_3$diff_perc, width = 0.5, add = c("mean", "jitter"), 
  ylab = "Difference (%)", xlab = FALSE
  )+
  ggtitle("Boxplot of Inspiration Intervention")+
  theme_solarized()

bxp_w_3



# Normality
ggqqplot(df_w_3, x = "diff_perc")



# Effect size
df_w_3 %>% cohens_d(diff_perc ~ 1, mu = 0) # small effect size

# Density plot
ggdensity(df_w_3, x = "diff_perc", rug = TRUE, fill = "lightgray") +
  scale_x_continuous(limits = c(-105, 230)) +
  stat_central_tendency(type = "mean", color = "red", linetype = "dashed") +
  geom_vline(xintercept = 0, color = "blue", linetype = "dashed") 



bxp_w_3
```
Access to the values returned by t.test() function
The result of t.test() function is a list containing the following components:


statistic: the value of the t test statistics
parameter: the degrees of freedom for the t test statistics
p.value: the p-value for the test
conf.int: a confidence interval for the mean appropriate to the specified alternative hypothesis.
estimate: the means of the two groups being compared (in the case of independent t test) or difference in means (in the case of paired t test).

Visualization
```{r}

df_overall <- rbind(df_w_1, df_w_2, df_w_3)

df_overall$intervention <- as.factor(df_overall$intervention)

df_overall %>%
  group_by(intervention) %>%
  summarise(mean_difference_score = mean(diff, na.rm = T), se = sd(diff, na.rm = T)/(sqrt(length(diff)))) %>% 
  ggplot(aes(intervention, mean_difference_score, fill = intervention)) +
  geom_bar(stat = "summary") +
  geom_errorbar(aes(ymin=mean_difference_score-se, ymax=mean_difference_score+se), width=.2,
                position=position_dodge(.9))


```

Hypothesis 4
```{r}

df_lab_nug <- read_csv("df_lab_nug.csv")

df_lab_nug$intervention <- as.factor(df_lab_nug$intervention)

# summary stats
df_lab_nug %>%
  group_by(intervention) %>%
  get_summary_stats(diff_perc, type = "mean_sd")


# Visualizing data
bxp_lab_nug <- ggboxplot(
  df_lab_nug, x = "intervention", y = "diff_perc", 
  ylab = "Difference (%)", xlab = "Intervention", add = "jitter"
  )+
  ggtitle("Comparison of Nudging and Label Intervention")+
  theme_solarized()
bxp_lab_nug


# Normality
ggqqplot(df_lab_nug, x = "diff_perc", facet.by = "intervention")



# Equality of variance
df_lab_nug %>% levene_test(diff_perc ~ intervention) # No significant difference


df_lab_nug$intervention <- relevel(df_lab_nug$intervention, ref = "nudge")

t.test(diff_perc ~ intervention, alternative = "greater", data = df_lab_nug) # Welch one-tailed two-sample t-test

# Effect size


 
df_lab_nug %>% cohens_d(diff_perc ~ intervention, var.equal = F)

```


```{r}
# Does inspiration have a greater effect than the two other interventions

# Relevel intervention - inspiration as baseline
df_overall$intervention <- relevel(df_overall$intervention, ref = "inspiration")

m1 <- lmer(diff ~ intervention + (1|vare_grp), data = df_overall, REML = FALSE)

summary(m1)
```


# T-test
```{r}
# Hypothesis 1

t.test(df_w_1$diff_perc, mu = 0, alternative = "greater")
wilcox.test(df_w_1$diff_perc, mu = 0, alternative = "greater")

# Hypothesis 2
t.test(df_w_2$diff_perc, mu = 0, alternative = "greater")

# Hypothesis 3
t.test(df_w_3$diff_perc, mu = 0, alternative = "greater")


```


```{r}
df_overall$diff_perc <- (df_overall$oms.x - df_overall$oms.y)/df_overall$oms.y*100

df_overall$diff_perc <- round(df_overall$diff_perc, digits = 1)

install.packages('ggthemes', dependencies = TRUE)
library(ggthemes)


df_overall %>%
  group_by(intervention) %>%
  summarise(mean_difference_score = mean(diff_perc, na.rm = T), se = sd(diff_perc, na.rm = T)/(sqrt(length(diff_perc)))) %>% 
  ggplot(aes(intervention, mean_difference_score, fill = intervention)) +
  geom_bar(stat = "summary") +
  geom_errorbar(aes(ymin=mean_difference_score-se, ymax=mean_difference_score+se), width=.2,
                position=position_dodge(.9))+
  theme_solarized()+
  scale_fill_brewer(palette="Blues")+
  labs(x = "Intervention", y = "Difference score in percentage")+
  ggtitle("Intervention Effect on Purchase of Climate-friendly Products")
```



```{r}
ggplot(data=chol, aes(chol$AGE)) + 
  geom_histogram()
```

